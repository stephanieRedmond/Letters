---
title: "Setting up an R ProjectTemplate"
output: html_notebook
---

Working from: http://projecttemplate.net/getting_started.html

Note: Save working Rmd's to the docs directory, where documentation should go.
Final analyses should be saved to the src directory.
#Load package & Initialize project
```{r, setup}
setwd('~/Box Sync/AAB Lab/100 Data/100 Data Analysis Files/102_R_Analyses/')

#install.packages('ProjectTemplate')
library('ProjectTemplate')
#create.project('letters')

#setwd('~/Box Sync/AAB Lab/100 Data/100 Data Analysis Files/102_R_Analyses/Letters')


load.project()

```


Downloaded example dataset, so move it into the data file:
in RStudio Terminal:
mv ~/Downloads/letters.csv.bz2 data

Now rerun initializing and see what happens:
```{r}

```
It loads the object 'letters' from the data directory!

```{r}
head(letters)
```
The 'munge' directory is for pre-processing steps that will happen automatically (sequentially by file Name) when the project is loaded. After preprocessing steps have been executed, the results can be cached and munging turned off in the config file.

Added two lines to the 01-A.R script:
first.letter.counts <- ddply(letters, c('FirstLetter'), nrow)
second.letter.counts <- ddply(letters, c('SecondLetter'), nrow)

```{r}
load.project()
```
Now we have two more objects: first.letter.counts & second.letter.counts

Let's cache them, and turn off munging to save processing time:
```{r}
cache('first.letter.counts')
cache('second.letter.counts')
```
in global.dcf: munging: FALSE

Now when we load the project, the munging should be off, and the cached objects should be loaded:
```{r}
load.project()
```

Analyses will be saved to the src directory, and let's see what happens when we make and save some plots:
```{r}
plot1 <- ggplot(first.letter.counts, aes(x = V1)) + geom_density()
plot1
ggsave(file.path('graphs', 'plot1.pdf'))

plot2 <- ggplot(second.letter.counts, aes(x = V1)) + geom_density()
plot2
ggsave(file.path('graphs', 'plot2.pdf'))
```
Yep - they are saved to the graphs directory!

Once we’ve saved our final R script analysis in the src directory, we can run the analysis by opening R and typing the single line:
(Note - does not work for Rmd's)
```{r}
source('src/FILENAME.R')
```



"After looking at our new density plots, we see that both the first and second letter distributions are very skewed. To make a note of this for posterity, we can write up our discovery in a text file that we store in the reports directory. Like the graphs directory, the reports directory is generated by ProjectTemplate automatically when we run create.project(). It’s meant to contain the sort of written descriptions of the results of your analyses that you’d publish in a scientific paper.

With that report written and stored in the reports directory, we’ve gone through the simplest sort of analysis you might run with ProjectTemplate. Along the way, we’ve shown some of ProjectTemplate’s basic and intermediate features. In a future piece of documentation, we’ll describe some of the more advanced features that ProjectTemplate offers."



##Logging Your Work
Logger: https://github.com/johnmyleswhite/log4r
If you want to log your work, ProjectTemplate will automatically load a log4r logger object into the logger variable that will write to a plain text stored at the logs/project.log. To use this logger, you only need to change the configuration file to specify:

logging: TRUE
After making this change, the logger object will be created once you call load.project():

Logging

The default loglevel can be set through the configuration file by setting the logging_level flag to one of the valid levels for log4r, by default it is set to “INFO”

```{r}
load.project()

```
Write to the logger manually:

```{r}


info(logger, "Messages are now written to the file instead.")
debug(logger, "Debug messages are now visible.")

readLines(logger$logfile)
```
It automatically saves to a running log file.

